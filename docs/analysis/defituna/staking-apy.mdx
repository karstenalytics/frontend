---
title: TUNA Staking APY
---

import ApyChart from '@site/src/components/Dashboard/ApyChart';
import { useEffect, useState } from 'react';

export function ApySummaryStats() {
  const [data, setData] = useState(null);
  const [loading, setLoading] = useState(true);
  const [userEntryPrice, setUserEntryPrice] = useState(null);

  useEffect(() => {
    // Load APY data
    fetch('/data/apy_data.json')
      .then(response => response.json())
      .then(jsonData => {
        setData(jsonData);
        setLoading(false);
      })
      .catch(err => {
        console.error('Error loading APY summary:', err);
        setLoading(false);
      });

    // Load user entry price from localStorage, default to 0.05 (public pre-sale price)
    const saved = localStorage.getItem('tunaEntryPrice');
    if (saved && !isNaN(parseFloat(saved))) {
      setUserEntryPrice(parseFloat(saved));
    } else {
      setUserEntryPrice(0.05);
    }

    // Listen for storage changes to sync across components
    const handleStorageChange = () => {
      const newSaved = localStorage.getItem('tunaEntryPrice');
      if (newSaved && !isNaN(parseFloat(newSaved))) {
        setUserEntryPrice(parseFloat(newSaved));
      } else {
        setUserEntryPrice(null);
      }
    };

    window.addEventListener('storage', handleStorageChange);
    // Also listen for custom event for same-page updates
    window.addEventListener('tunaEntryPriceChanged', handleStorageChange);

    return () => {
      window.removeEventListener('storage', handleStorageChange);
      window.removeEventListener('tunaEntryPriceChanged', handleStorageChange);
    };
  }, []);

  if (loading) {
    return <div style={{ padding: '24px', textAlign: 'center', color: 'var(--ifm-color-secondary)' }}>Loading summary statistics...</div>;
  }

  if (!data || !data.summary || Object.keys(data.summary).length === 0) {
    return <div style={{ padding: '24px', textAlign: 'center', color: 'var(--ifm-color-secondary)' }}>No summary statistics available</div>;
  }

  const summary = data.summary;

  // Calculate personalized APY stats if user entry price is available
  let personalizedStats = null;
  if (userEntryPrice !== null && userEntryPrice > 0 && data.daily_apy) {
    const personalizedApyValues = data.daily_apy
      .filter(d => d.revenue_per_tuna_usdc)
      .map(d => (d.revenue_per_tuna_usdc / userEntryPrice) * 100);

    if (personalizedApyValues.length > 0) {
      personalizedStats = {
        current: personalizedApyValues[personalizedApyValues.length - 1],
        average: personalizedApyValues.reduce((a, b) => a + b, 0) / personalizedApyValues.length,
        max: Math.max(...personalizedApyValues),
        min: Math.min(...personalizedApyValues),
      };
    }
  }

  const StatCard = ({ label, marketValue, personalizedValue }) => (
    <div style={{
      padding: '24px',
      background: 'var(--ifm-background-surface-color)',
      border: '1px solid var(--ifm-toc-border-color)',
      borderRadius: 'var(--ifm-global-radius)',
    }}>
      <div style={{ fontSize: '14px', color: 'var(--ifm-color-secondary)', marginBottom: '8px' }}>{label}</div>
      <div style={{ fontSize: '28px', fontWeight: '600', color: label.includes('Current') ? 'var(--accent)' : 'inherit' }}>
        {marketValue?.toFixed(2)}%
      </div>
      {personalizedValue !== null && personalizedValue !== undefined && (
        <div style={{ fontSize: '16px', fontWeight: '500', color: 'rgba(34, 197, 94, 1)', marginTop: '8px' }}>
          Custom APY: {personalizedValue.toFixed(2)}%
        </div>
      )}
    </div>
  );

  return (
    <div style={{
      display: 'grid',
      gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))',
      gap: '16px',
      marginBottom: '32px',
    }}>
      <StatCard
        label="Current APY"
        marketValue={summary.current_apy}
        personalizedValue={personalizedStats?.current}
      />
      <StatCard
        label="Average APY"
        marketValue={summary.average_apy}
        personalizedValue={personalizedStats?.average}
      />
      <StatCard
        label="Maximum APY"
        marketValue={summary.max_apy}
        personalizedValue={personalizedStats?.max}
      />
      <StatCard
        label="Minimum APY"
        marketValue={summary.min_apy}
        personalizedValue={personalizedStats?.min}
      />
    </div>
  );
}

# TUNA Staking APY

This dashboard shows the historical development of the Annual Percentage Yield (APY) for staking TUNA tokens, calculated based on the DefiTuna protocol's treasury revenue.

## Current Statistics

<ApySummaryStats />

## APY Development Over Time

<ApyChart />

## Methodology

The TUNA staking APY is calculated using the following approach:

### Key Parameters

- **TUNA Supply**: Fixed at 1,000,000,000 tokens
- **Rolling Window**: Up to 30 days of historical revenue data
- **Revenue Source**: Treasury WSOL inflows (validated against DefiTuna API)
- **TUNA Price**: Latest available TUNA/SOL price from swap data

### Calculation Formula

The APY calculation follows these steps:

1. **Rolling Revenue Sum**: Sum of treasury WSOL inflows over the last 30 days (or fewer for early dates)

2. **Annualized Revenue**:
   ```
   Annualized Revenue = (Rolling Revenue Sum / Days in Window) × 365
   ```

3. **Revenue per TUNA**:
   ```
   Revenue per TUNA = Annualized Revenue / 1,000,000,000
   ```

4. **APY**:
   ```
   APY (%) = (Revenue per TUNA / TUNA Price in SOL) × 100
   ```

### Example Calculation

For a given day with the following data:
- 30-day rolling revenue: 10,000 SOL
- TUNA price: 0.0005 SOL

The APY would be calculated as:
```
Annualized Revenue = (10,000 / 30) × 365 = 121,667 SOL
Revenue per TUNA = 121,667 / 1,000,000,000 = 0.00012167 SOL
APY = (0.00012167 / 0.0005) × 100 = 24.33%
```

### USD Conversion Methodology

**Daily Spot Rates (Current)**:

As of January 2025, USD values are calculated using **daily spot market rates** fetched from the DefiTuna API. This ensures our USD calculations match the protocol's official values with 100% accuracy.

- **API Endpoint**: `https://api.defituna.com/api/v1/stats/staking/revenue`
- **Rate Calculation**: For each day, USD/SOL rate = (daily USD deposits) / (daily SOL deposits)
- **Accuracy**: 100% match with DefiTuna API (verified daily)

**Example**: On October 10, 2025, the spot rate was $181.11/SOL, so 926.36 SOL revenue = $167,771.22 USD.

**Previous Approach** (deprecated): Used a single historical average rate ($198.98/SOL) for all dates, which caused USD values to differ from the API.

### Data Notes

- **Early History**: For dates with less than 30 days of historical data, the APY is calculated using all available days and annualized accordingly.
- **Price Data**: TUNA/SOL prices are sourced from the same data used for SwapReward ATA conversion logic, ensuring consistency with the revenue attribution system.
- **Revenue Validation**: All revenue figures are validated against the DefiTuna public API to ensure 100% accuracy.
- **USD Values**: Calculated using daily spot market rates from the DefiTuna API, ensuring exact match with protocol's official USD values.

## Understanding the Chart

The chart displays:
- **X-axis**: Date
- **Y-axis**: APY in percentage
- **Hover**: Shows detailed breakdown including:
  - APY percentage
  - Number of days in rolling window
  - Daily revenue for that date
  - TUNA price in SOL

The APY naturally fluctuates based on:
1. **Treasury Revenue**: Higher protocol activity increases treasury inflows
2. **TUNA Price**: Price movements affect the yield calculation
3. **Historical Window**: Early days with less historical data may show higher volatility

## Personalized APY Feature

The dashboard allows you to calculate your personalized APY based on your actual TUNA entry price.

### How It Works

**Formula**:
```
Custom APY (%) = (Revenue per TUNA in USD / Your Entry Price in USD) × 100
```

**Default**: If no price is entered, defaults to $0.05 (public pre-sale price).

**Example**:
- Market TUNA price: $0.20
- Your entry price: $0.05
- Revenue per TUNA: $0.012

Market APY: ($0.012 / $0.20) × 100 = **6.0%**
Custom APY: ($0.012 / $0.05) × 100 = **24.0%**

### Features

- **Interactive Input**: Enter your entry price below the chart
- **Dual Chart Traces**: Green dashed line shows your personalized APY
- **Summary Stats**: Each stat card displays both market and Custom APY
- **localStorage Persistence**: Your entry price is saved across sessions
- **Real-time Updates**: Chart updates immediately when you change the price

### Why This Matters

If you purchased TUNA at a lower price than the current market price, your effective APY is higher because:
- The protocol revenue is the same
- But your cost basis was lower
- Therefore, your return on investment is higher

This feature helps you understand your actual yield based on your investment, not just the market yield.

## Technical Details

For developers and technical users interested in how the APY calculation works:

- **Backend Documentation**: See [APY Calculation System](https://github.com/yourusername/solana_analytics/blob/main/docs/APY_CALCULATION_SYSTEM.md) in the `solana_analytics` repository for complete technical details
- **Component Source**: `frontend/src/components/Dashboard/ApyChart.tsx`
- **Data Source**: `frontend/static/data/apy_data.json` (generated by `tools/compute_apy_data.py`)

### Data Update Frequency

The APY data is manually updated when:
- New treasury transaction data is loaded
- TUNA price data is updated
- USD/SOL exchange rates change significantly

For the most current data, check the "Last updated" timestamp in the site header.


